<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Get quick insights on your contracts</title>
  <meta name="description" content="">
  <link rel="icon" href="assets/img/favicon.svg">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <!-- lightbox -->
  <link rel="stylesheet" href="assets/css/fancybox.css" />
</head>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const params = new URLSearchParams(window.location.search);
      const contractName =
        params.get('contract') ||
        params.get('Contract') ||
        sessionStorage.getItem('contractName'); // if you used sessionStorage earlier

      const titleEl = document.getElementById('contract-title');
      if (titleEl && contractName) {
        titleEl.textContent = contractName;
      }

      // Load process result (classification + highlighted URL)
      try {
        const raw = sessionStorage.getItem('processResult');
        if (raw) {
          const data = JSON.parse(raw);
          // Update score label (basic example)
          const scoreEls = document.querySelectorAll('.score-overview');
          scoreEls.forEach(el => el.classList.remove('active'));
          const map = {
            'unlikely': 'none',
            'possible': 'basic',
            'likely': 'moderate',
            'very likely': 'strong'
          };
          const cls = map[(data.classification || '').toLowerCase()] || 'none';
          const target = document.querySelector('.score-overview.' + cls);
          if (target) target.classList.add('active');

          // Add link to highlighted output if available
          const p = document.querySelector('.context');
          if (p && data.highlighted_output_url) {
            const a = document.createElement('a');
            a.href = data.highlighted_output_url;
            a.target = '_blank';
            a.textContent = 'Open highlighted analysis';
            const sep = document.createTextNode(' ');
            p.appendChild(document.createElement('br'));
            p.appendChild(sep);
            p.appendChild(a);
          }
        }
      } catch (e) {
        // ignore
      }
    });
  </script>
</head>

<body class=""><!-- use classes "vanilla" for minimal styling mode, or "animated" for changing background gradient -->
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="site-header row" role="banner">
    <div class="container">
      <h1 class="site-title">
        <img src="assets/img/logo-white.svg" class="white" />
        <img src="assets/img/logo.svg" class="blue" />
      </h1>
      <!--
      <nav aria-label="Primary" class="site-nav">
        <a class="btn" href="https://chancerylaneproject.org/" target="_blank">Main site</a>
      </nav> -->
    </div>
  </header>

  <main id="main" class="site-main row" role="main">
    <section class="container">
      <div class="row report">

          <section class="summary">
            <div class="govuk-phase-banner">
              <p class="govuk-phase-banner__content">
                <strong class="govuk-tag govuk-phase-banner__content__tag">
                  Alpha
                </strong>
                <span class="govuk-phase-banner__text">
                  Learn how to reduce emissions and build climate resilience in a contract
                </span>
              </p>
            </div>
            <h2 id="contract-title">[Contract name will go here]</h2>
            <div class="row meta-data-summary">
              <span>
                  <strong>Sector:</strong><br />
                  Public Sector
              </span>
              <span>
                  <strong>Subject matter:</strong><br />
                  Service Level Agreement
              </span>
              <span>
                  <strong>Content:</strong><br />
                  5 pages / 3,116 words
              </span>
              <span>
                  <strong>Analysis time:</strong><br />
                  5 seconds
              </span>
            </div>
            <div class="row scoring">
              <div class="col score-summary">

                <p class="score-overview none">None</p>
                <p class="score-overview basic">BASIC</p>
                <p class="score-overview moderate">Moderate</p>
                <p class="score-overview strong">Strong</p>


                <p class="context"><strong>Climate-aligned language detected</strong><br/>Some climate-aligned clauses included and mentions of carbon footprint.</p>
              </div>
              <div class="col quant-summary">
                <p><strong>17</strong> Reccomended clauses</p>
              </div>
              <div class="col quant-summary">
                <p><strong>2</strong> Possible emissions addressed</p>
              </div>
            </div>
          </section>

          <section class="row">
              <h2>Recommended clauses to review</h2>
              <div class="row clause-stack" id="recommendation-list">
                <!-- Clauses will be dynamically inserted here by JS below -->
                <noscript>
                  <article class="clause">
                    <div class="row clause-inner">
                      <p class="child-name">[Clause name]</p>
                      <h3 class="clause-title">[Clause title]</h3>
                      <p class="clause-excerpt">
                        [Clause excerpt/summary]
                      </p>
                      <time><strong>Updated:</strong> [Date]</time>
                    </div>
                    <div class="row clause-toggle">
                      <h4>Show emissions and how they're addressed</h4>
                      <div class="row clause-toggle-inner">
                        <table>
                          <thead>
                            <tr>
                              <th scope="col">Emissions source</th>
                              <th scope="col">How itâ€™s addressed</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>[Source]</td>
                              <td>[How addressed]</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </article>
                </noscript>
              </div>
          </section>


      </div>
    </section>
  </main>

  <footer class="site-footer row" role="contentinfo">
    <div class="container">
    </div>
  </footer>

  <div class="bg-grad"></div>

  <!-- lightbox -->
  <script src="assets/js/fancybox.umd.js"></script>
  <script src="assets/js/main.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Load recommendations from sessionStorage
      try {
        const raw = sessionStorage.getItem('recommendResult');
        if (raw) {
          const data = JSON.parse(raw);
          const list = document.getElementById('recommendation-list');
          if (list && data.matches && data.matches.length > 0) {
            // Clear any existing content and replace with real recommendations
            list.innerHTML = '';
            
            data.matches.forEach((m, index) => {
              const article = document.createElement('article');
              article.className = 'clause';
              article.innerHTML = `
                <div class="row clause-inner">
                  <h3 class="clause-title">${m.name || 'Unnamed clause'}</h3>
                  <p class="clause-excerpt">${m.excerpt || 'No excerpt available'}</p>
                </div>
                <div class="row clause-toggle">
                  <h4>Show emissions and how they're addressed</h4>
                  <div class="row clause-toggle-inner">
                    <p><strong>Reasoning:</strong> ${m.reason || 'No reasoning provided'}</p>
                    ${m.risks ? `<p><strong>Climate risks addressed:</strong> ${m.risks}</p>` : ''}
                  </div>
                </div>
              `;
              list.appendChild(article);
            });
          } else {
            // If no recommendations, show a message
            const list = document.getElementById('recommendation-list');
            if (list) {
              list.innerHTML = '<p>No specific clauses were recommended for this contract.</p>';
            }
          }
        } else {
          // If no recommendResult in sessionStorage, show a message
          const list = document.getElementById('recommendation-list');
          if (list) {
            list.innerHTML = '<p>No recommendations available. Please try uploading a contract or selecting a sample.</p>';
          }
        }
      } catch (e) {
        console.error('Error loading recommendations:', e);
        // Show error message
        const list = document.getElementById('recommendation-list');
        if (list) {
          list.innerHTML = '<p>Error loading recommendations. Please try again.</p>';
        }
      }
    });
  </script>

</body>
</html>
